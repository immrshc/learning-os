;************************************************************************
;	BIOS????[?h?????????Z?N?^
;	
;	?v???O?????S???????A?Z?O?????g??l??0x0000?????B
;	(DS==ES==0)
;	
;************************************************************************
		BOOT_LOAD	equ		0x7C00				; ?u?[?g?v???O????????[?h??u

		ORG		BOOT_LOAD						; ???[?h?A?h???X???A?Z???u????w??

;************************************************************************
;	?}?N??
;************************************************************************
%include	"../include/macro.s"

;************************************************************************
;	?G???g???|?C???g
;************************************************************************
entry:
		;---------------------------------------
		; BPB(BIOS Parameter Block)
		;---------------------------------------
		jmp		ipl								; IPL??W?????v
		times	90 - ($ - $$) db 0x90			; 

		;---------------------------------------
		; IPL(Initial Program Loader)
		;---------------------------------------
ipl:
		cli										; // ???????~

		mov		ax, 0x0000						; AX = 0x0000;
		mov		ds, ax							; DS = 0x0000;
		mov		es, ax							; ES = 0x0000;
		mov		ss, ax							; SS = 0x0000;
		mov		sp, BOOT_LOAD					; SP = 0x7C00;

		sti										; // ?????????

		mov		[BOOT.DRIVE], dl				; ?u?[?g?h???C?u????

		;---------------------------------------
		; ???????\??
		;---------------------------------------
		cdecl	puts, .s0						; puts(.s0);

		;---------------------------------------
		; ??????I??
		;---------------------------------------
		jmp		$								; while (1) ; // ???????[?v

		;---------------------------------------
		; ?f?[?^
		;---------------------------------------
.s0		db	"Booting...", 0x0A, 0x0D, 0

ALIGN 2, db 0
BOOT:											; ?u?[?g?h???C?u????????
.DRIVE:			dw	0							; ?h???C?u???

;************************************************************************
;	???W???[??
;************************************************************************
%include	"../modules/real/puts.s"

;************************************************************************
;	?u?[?g?t???O?i??512?o?C?g??I???j
;************************************************************************
		times	510 - ($ - $$) db 0x00
		db	0x55, 0xAA

